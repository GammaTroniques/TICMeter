/**
 * @file power.c
 * @author Dorian Benech
 * @brief
 * @version 1.0
 * @date 2023-10-11
 *
 * @copyright Copyright (c) 2023 GammaTroniques
 *
 */

/*==============================================================================
 Local Include
===============================================================================*/
#include <stdio.h>
#include "freertos/FreeRTOS.h"
#include "freertos/task.h"
#include "freertos/event_groups.h"

#include "esp_pm.h"
#include "esp_private/esp_clk.h"
#include "esp_log.h"

#include "power.h"
/*==============================================================================
 Local Define
===============================================================================*/

/*==============================================================================
 Local Macro
===============================================================================*/
#define TAG "POWER"
/*==============================================================================
 Local Type
===============================================================================*/

/*==============================================================================
 Local Function Declaration
===============================================================================*/

/*==============================================================================
Public Variable
===============================================================================*/

/*==============================================================================
 Local Variable
===============================================================================*/

/*==============================================================================
Function Implementation
===============================================================================*/

esp_err_t power_set_frequency(uint32_t freq_Mhz)
{
    esp_err_t ret = ESP_OK;
    esp_pm_config_t pm_config = {
        .max_freq_mhz = freq_Mhz,
        .min_freq_mhz = freq_Mhz,
    };
    ret = esp_pm_configure(&pm_config);
    if (ret != ESP_OK)
    {
        ESP_LOGE(TAG, "esp_pm_configure failed");
    }
    else
    {
        ESP_LOGI(TAG, "Frequency set to %ld MHz", freq_Mhz);
    }
    return ret;
}